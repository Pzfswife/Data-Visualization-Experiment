<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <title>城市 GDP 矩阵分区图</title>
  <style>
    .node {
      position: relative;
      font-family: sans-serif;
      overflow: hidden;
      border: 1px solid white;
    }

    .node text {
      font-size: 10px;
      text-anchor: middle;
      fill: #ffffff;
      /* 设置文本颜色 */
    }
  </style>
</head>

<body>
<h2>城市 GDP 矩阵分区图</h2>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script>
  var width = 600,
    height = 400;

  // 创建一个对象用于存储省份和对应颜色的映射
  var provinceColorMap = {};
  var color = d3.scale.category20();

  var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g");

  var treemap = d3.layout.treemap()
    .size([width, height])
    .value(function (d) { return d.gdp; });

  d3.json("city_gdp.json", function (error, root) {
    if (error) throw error;

    // 先遍历一遍数据，为每个省份分配颜色并记录到映射对象中
    root.children.forEach(function (province) {
      var provinceName = province.name;
      if (!provinceColorMap[provinceName]) {
        provinceColorMap[provinceName] = color(provinceName);
      }
    });

    var nodes = treemap.nodes(root)
      .filter(function (d) { return!d.children; });

    var groups = svg.selectAll("g")
      .data(nodes.filter(function (d) { return!d.children; }))
      .enter()
      .append("g")

    var rects = groups.append("rect")
      .attr("class", "nodeRect")
      .attr("x", function (d) { return d.x; })
      .attr("y", function (d) { return d.y; })
      .attr("width", function (d) { return d.dx; })
      .attr("height", function (d) { return d.dy; })
      .attr("fill", function (d) {
        var province = d.parent.name;
        if (provinceColorMap[province]) {
          return provinceColorMap[province];
        }
        return "gray";
      });

    var texts = groups.append("text")
      .attr("class", "nodeName")
      .attr("x", function (d) { return d.x + d.dx / 2; })
      .attr("y", function (d) { return d.y + d.dy / 2; })
      .attr("dx", "-1em")
      .attr("dy", "0.5em")
      .attr("fill","#ffffff")
      .text(function (d) {
        return d.name; // 只显示城市名称，去除gdp显示
      });
  });
</script>
</body>

</html>
