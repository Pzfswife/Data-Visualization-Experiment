<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>职称占比图</title>
</head>
<body>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>高校教师职称比例饼图</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
<h1>高校教师职称比例饼图</h1>
<svg width="600" height="400"></svg>
<script>
  var data = [
    { label: "高级职称", value: 0.3 },
    { label: "硕士学位教师", value: 0.358 },
    { label: "本科学位教师", value: 0.342 }
  ];

  var width = 500;
  var height = 400;
  var radius = Math.min(width, height) / 2 - 50; // 适当调整饼图半径，以便图例能够放得下

  var color = d3.scaleOrdinal()
    .domain(data.map(function (d) { return d.label; }))
    .range(['#a4195f', '#2d66ad', '#55a222']);

  var svg = d3.select("svg")
    .append("g")
    .attr("transform", "translate(" + width / 3 + "," + height / 2 + ")");

  var pie = d3.pie()
    .value(function (d) { return d.value; });

  var arc = d3.arc()
    .innerRadius(0)
    .outerRadius(radius);

  var arcs = svg.selectAll(".arc")
    .data(pie(data))
    .enter()
    .append("g")
    .attr("class", "arc");

  arcs.append("path")
    .attr("d", arc)
    .attr("fill", function (d) { return color(d.data.label); });

  arcs.append("text")
    .attr("transform", function (d) {
      var centroid = arc.centroid(d);
      return "translate(" + centroid[0] + "," + centroid[1] + ")";
    })
    .attr("text-anchor", "middle")
    .text(function (d) {
      return Math.round(d.data.value * 100) + "%";
    });

  // 图例
  var legendG = svg.append("g")
    .attr("transform", "translate(" + (width / 2 + 60) + "," + (height / 2 - radius) + ")");

  legendG.selectAll(".legend")
    .data(data)
    .enter()
    .append("rect")
    .attr("x", 0)
    .attr("y", function (d, i) { return i * 20; })
    .attr("width", 15)
    .attr("height", 15)
    .attr("fill", function (d) { return color(d.label); });

  legendG.selectAll(".legend-label")
    .data(data)
    .enter()
    .append("text")
    .attr("x", 20)
    .attr("y", function (d, i) { return i * 20 + 12; })
    .text(function (d) { return d.label; });
</script>
</body>
</html>

