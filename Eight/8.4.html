<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>游客数量条形图</title>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <style>
    .axis path,
    .axis line { fill: none; stroke: black; shape-rendering: crispEdges; }
    .axis text { font-family: sans-serif; font-size: 11px; }
    .MyRect { }
    .MyText { fill: #000000; text-anchor: middle; font-size: 10px; }
    .legend rect { cursor: pointer; }
    .legend text { font-family: sans-serif; font-size: 12px; }
    .x-label, .y-label { font-family: sans-serif; font-size: 12px; font-weight: bold; }
  </style>
</head>
<body>
<script>
  // 数据
  const data = [
    { year: "2009年", domestic: 1902, urban: 0, rural: 0 },
    { year: "2010年", domestic: 2103, urban: 903, rural: 999 },
    { year: "2011年", domestic: 2641, urban: 1065, rural: 1038 },
    { year: "2012年", domestic: 2957, urban: 1687, rural: 954 },
    { year: "2013年", domestic: 3262, urban: 1933, rural: 1024 },
    { year: "2014年", domestic: 3611, urban: 2186, rural: 1076 },
    { year: "2015年", domestic: 4000, urban: 2483, rural: 1128 },
    { year: "2016年", domestic: 4440, urban: 2802, rural: 1188 },
    { year: "2017年", domestic: 5001, urban: 3195, rural: 1240 },
    { year: "2018年", domestic: 5540, urban: 3677, rural: 1324 },
  ];

  // 画布大小
  var width = 600;
  var height = 400;
  var padding = { left: 100, right: 30, top: 20, bottom: 60 };

  // 添加SVG画布
  var svg = d3.select("body")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  // 定义比例尺
  var xScale = d3.scale.linear()
    .domain([0, d3.max(data, d => Math.max(d.domestic, d.urban, d.rural))])
    .range([0, width - padding.left - padding.right]);

  var yScale = d3.scale.ordinal()
    .domain(data.map(d => d.year))
    .rangeRoundBands([0, height - padding.top - padding.bottom], 0.1);

  // 颜色映射
  var colors = {
    domestic: "steelblue",
    urban: "orange",
    rural: "green"
  };

  // 添加条形
  var yearGroups = svg.selectAll(".yearGroup")
    .data(data)
    .enter()
    .append("g")
    .attr("class", "yearGroup")
    .attr("transform", (d, i) => "translate(" + padding.left + "," + (padding.top + yScale(d.year)) + ")");

  // 添加条形图
  yearGroups.selectAll("rect")
    .data(d => [
      { value: d.domestic, category: "domestic" },
      { value: d.urban, category: "urban" },
      { value: d.rural, category: "rural" }
    ])
    .enter()
    .append("rect")
    .attr("class", "MyRect")
    .attr("y", (d, i) => i * (yScale.rangeBand() / 3)) // 各类条形的y位置
    .attr("x", 0) // 所有条形从x位置0开始
    .attr("height", yScale.rangeBand() / 3 - 2) // 计算条形高度
    .attr("width", d => xScale(d.value)) // 根据值计算宽度
    .attr("fill", d => colors[d.category]) // 根据类别设置颜色
    .transition()
    .duration(2000)
    .ease("bounce");

  // 添加坐标轴
  svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + padding.left + "," + (height - padding.bottom) + ")")
    .call(d3.svg.axis().scale(xScale).orient("bottom").ticks(5));

  // 在 x 轴下方添加标签
  svg.append("text")
    .attr("class", "x-label")
    .attr("x", padding.left + (width - padding.left - padding.right) / 2)
    .attr("y", height - padding.bottom / 2)
    .attr("text-anchor", "middle")
    .text("游客数量");

  // 添加 y 轴
  svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + padding.left + "," + padding.top + ")")
    .call(d3.svg.axis().scale(yScale).orient("left"));

  // 在 y 轴左侧添加标签
  svg.append("text")
    .attr("class", "y-label")
    .attr("x", -(height - padding.top - padding.bottom) / 2 - padding.top)
    .attr("y", padding.left / 4)
    .attr("transform", "rotate(-95)")
    .attr("text-anchor", "middle")
    .text("年份");

  // 添加文本标签
  yearGroups.selectAll(".MyText")
    .data(d => [
      { value: d.domestic, category: "domestic" },
      { value: d.urban, category: "urban" },
      { value: d.rural, category: "rural" }
    ])
    .enter()
    .append("text")
    .attr("class", "MyText")
    .attr("y", (d, i) => i * (yScale.rangeBand() / 3) + (yScale.rangeBand() / 3) / 2) // 计算文本y位置
    .attr("x", d => xScale(d.value) + 5) // 将文本放在条形内部
    .text(d => d.value);

  // 添加图例
  var legend = svg.selectAll(".legend")
    .data(Object.keys(colors))
    .enter()
    .append("g")
    .attr("class", "legend")
    .attr("transform", (d, i) => "translate(20," + (padding.top + i * 20) + ")");

  legend.append("rect")
    .attr("x", width - padding.right)
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", d => colors[d]);

  legend.append("text")
    .attr("x", width - padding.right + 25)
    .attr("y", 9)
    .attr("dy", ".35em")
    .style("text-anchor", "start")
    .text(d => {
      switch (d) {
        case 'domestic':
          return "国内游客";
        case 'urban':
          return "城镇游客";
        case 'rural':
          return "农村游客";
        default:
          return "";
      }
    });

  // 添加文字说明在图例旁边
  legend.append('text')
    .attr('x', width -30)
    .attr('y', 9)
    .attr('dy', '.35em')
    .style('text-anchor', 'end')
    .text(d => {
      switch (d) {
        case 'domestic':
          return '国内游客';
        case 'urban':
          return '城镇居民国内游客';
        case 'rural':
          return '农村居民国内游客';
      }
    });

</script>
</body>
</html>
